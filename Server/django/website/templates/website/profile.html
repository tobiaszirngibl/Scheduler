{% extends 'website/base.html' %}
{% load static %}

{% block test %}

<div class="collapse navbar-collapse pull-right" id="navbar-collapse" xmlns="http://www.w3.org/1999/html">
          <ul class="nav navbar-nav">
            <li><a href="/calendar"><i class="fa fa-calendar" aria-hidden="true"></i> Kalender<span class="sr-only">(current)</span></a></li>
            <li><a href="/groups"><i class="fa fa-users" aria-hidden="true"></i> Gruppenverwaltung</a></li>
              <li class="active"><a href="/profile"><i class="fa fa-user" aria-hidden="true"></i> Nutzerverwaltung</a></li>

          </ul>
          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" class="form-control" id="navbar-search-input" placeholder="Search for user">

            </div>
          </form>
        </div>



        </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->

       <div id="testingHide">

<ul id="myUL">
</ul>
                </div>



<div id="userModal" class="modal fade modal-primary">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 id="modalUserName"></h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-8">
                                <div>
                                    <label>Email:</label>
                                </div>
                                  <div>
                                   <p id="modalUserMail"></p>
                                </div>
                                <div>
                                    <label>Telefon:</label>
                                </div>
                                <div>
                                   <p id="modalUserTel"></p>
                                </div>
                                <div>
                                    <label>Anmerkungen zu Kontaktdaten:</label>
                                </div>
                                 <div>
                                   <p id="modalUserNote"></p>
                                </div>
                                <div>
                                    <label>Standort:</label>
                                </div>
                                <div>
                                    <p id="modalUserPlace"></p>
                                </div>
                                <div>
                                    <label>Ausbildung:</label>
                                </div>
                                 <div>
                                    <p id="modalUserAusbildung"></p>
                                </div>
                                <div>
                                    <label>Skills:</label>
                                </div>
                                 <div>
                                    <p id="modalUserSkills"></p>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div>
                                   <!-- <img src="../dist/img/user2-160x160.jpg" id="modalUserImg"></img> -->
                                </div>
                            <br>
                             <div>
                                    <p id="modalUserJob">Schauspieler</p>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Schließen</button>
                    </div>
                </div>
            </div>
        </div>



  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">

<section class="content-header">
      <h1>
        Benutzer

      </h1>

    </section>

    <!-- Main content -->
    <section class="content">

      <div class="row">
        <div class="col-md-3">

          <!-- Profile Image -->
          <div class="box box-primary">
            <div class="box-body box-profile">
                   <button type="button" class="editContact btn btn-primary btn-sm pull-right"><span class="glyphicon glyphicon glyphicon-pencil"></span></button>
                <br>
                <br>
              <img class="profile-user-img img-responsive img-circle" src="{% static 'website/dist/img/user2-160x160.jpg' %}" alt="User profile picture">
    
              <h3 class="profile-username text-center"> {{user.firstname}} {{user.lastname}}</h3>

              <p class="text-muted text-center">Software Engineer</p>

              <ul class="list-group list-group-unbordered">
                <li class="list-group-item">
                  <b>E-Mail</b> <a class="pull-right">{{user.email}}</a>
                </li>
                <li class="list-group-item">
                  <b>Telefon</b> <a class="pull-right">0941/4353523</a>
                </li>
                 <li class="list-group-item">
                     <b>Anmerkungen zu Kontaktdaten</b>

              <p>{{user.bio}}</p>
                 </li> 
          

             
            </div>
            <!-- /.box-body -->
          </div>

          <!-- /.box -->
   </div>
          <!-- About Me Box -->
        <div class="col-md-9">
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Über mich</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <strong><i class="fa fa-book margin-r-5"></i> Ausbildung</strong>

              <p class="text-muted">
                B.S. in Computer Science from the University of Tennessee at Knoxville
              </p>

              <hr>

              <strong><i class="fa fa-map-marker margin-r-5"></i> Standort</strong>

              <p class="text-muted">Malibu, California</p>

              <hr>
                
                
                 <strong><i class="fa fa-clock-o margin-r-5" ></i></i> Freie Zeiten</strong>

              <p class="text-muted">Montags 13-16 Uhr, Freitags 8-12 Uhr</p>

              <hr>

              <strong><i class="fa fa-pencil margin-r-5"></i> Skills</strong>

              <p>
                <span class="label label-danger">UI Design</span>
                <span class="label label-success">Coding</span>
                <span class="label label-info">Javascript</span>
                <span class="label label-warning">PHP</span>
                <span class="label label-primary">Node.js</span>
              </p>



            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->

    </section>

      <div id="userEdit" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">{{user.firstname}} {{user.lastname}} - {{user.email}}</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Berufsbezeichnung</label>
                            <input id="jobEdit" type="text" class="form-control" value={{user.lastname}}>
                        </div>
                        <div class="form-group">
                            <label>Telefon:</label>
                            <input id="telEdit" type="text" class="form-control" value={{user.firstname}}>
                        </div>
                        <div class="form-group">
                            <div class="form-group">
                                <label>Anmerkungen zu Kontaktdaten:</label>
                                 <input id="notesEdit" type="text" class="form-control" value={{user.bio}}>
                            </div>
                        </div>
                       <div class="form-group">
                            <div class="form-group">
                                <label>Ausbildung:</label>
                                 <input id="lifeEdit" type="text" class="form-control" value={{user.bio}}>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-group">
                                <label>Standort:</label>
                                 <input id="placeEdit" type="text" class="form-control" value={{user.bio}}>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-group">
                                <label>Fähigkeiten:</label>
                                 <input id="skillsEdit" type="text" class="form-control" value={{user.bio}}>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-group">
                                <label>Freie Zeiten:</label>
                                 <input id="freetimeEdit" type="text" class="form-control" value={{user.bio}}>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Schließen</button>
                        <button id="saveUserEdit" type="button" class="btn btn-primary">Bearbeitung abschicken</button>
                    </div>
                </div>
            </div>
        </div>






{% endblock %}
{% block calFunc %}



     $(function () {


      var csrftoken = $.cookie('csrftoken');

function csrfSafeMethod(method) {
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});


      $("#testingHide").hide();

    $.ajax({
            type: "GET",
            url: "http://localhost:8000/api/actor/",
            success: function(data)
                {
                    for (var key in data) {
                        if(data[key].first_name ==  "" && data[key].last_name == "") {
                            var actorName = "Kein Name angegeben";
                        }
                        else {
                            var actorName = data[key].first_name + " " + data[key].last_name;
                        }
                    var actorEmail = data[key].email;
                    $('#myUL').append('<li><a id='+data[key].id+' class="userSearchResult">'+actorEmail+' - ' + actorName +'</a></li>');


                    }


                }
        });

             $("#myUL").on("click", ".userSearchResult", function(e){


var userID = e.currentTarget.id;
                $.ajax({
            type: "GET",
                url: "http://localhost:8000/api/actor/"+userID+"/",
            success: function (data) {
        $("#modalUserName").text(data.first_name +" "+ data.last_name);
        $("#modalUserMail").text(data.email);
        //$("#modalUserTel").text(data.tel);
        //$("#modalUserNote").text(data.notes);
        //$("#modalUserPlace").text(data.place);
            }
        });



        $("#userModal").modal('show');

      });







    $('.editContact').tooltip({
    'show': true,
        'placement': 'bottom',
        'title': "Profil bearbeiten"
    });

 $('.editContact').click(function() {
    $("#userEdit").modal("show");
      });

      $('#saveUserEdit').click(function() {

var bioEdit = $("#notesEdit").val();

var formData = {bio: bioEdit};
$.ajax({

    url : "http://localhost:8000/api/actor/1/",
    type: "PATCH",



    data : formData,
    success: function(data, textStatus, jqXHR)
    {
                                        $('#userEdit').modal('hide');

      location.reload();
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
console.log(jqXHR);
    }
});

      });


      $('#navbar-search-input').on('keyup', function() {



                $("#testingHide").show();

$(".content-wrapper").hide();
    // Declare variables
    var input, filter, ul, li, a, i;
    input = document.getElementById('navbar-search-input');
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL");
    li = ul.getElementsByTagName('li');

    // Loop through all list items, and hide those who don't match the search query
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";
        }
    }
                if(input.value === "") {
                   $("#testingHide").hide();

$(".content-wrapper").show();
                }

});

      });
    
{% endblock %}