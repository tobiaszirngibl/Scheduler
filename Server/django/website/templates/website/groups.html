{% extends 'website/base.html' %}
{% block test %}


        <div class="collapse navbar-collapse pull-right" id="navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="/calendar"><i class="fa fa-calendar" aria-hidden="true"></i> Kalender<span class="sr-only">(current)</span></a></li>
            <li class="active"><a href="/groups"><i class="fa fa-users" aria-hidden="true"></i> Gruppenverwaltung</a></li>
              <li><a href="/profile"><i class="fa fa-user" aria-hidden="true"></i> Nutzerverwaltung</a></li>

          </ul>
          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" class="form-control" id="navbar-search-input" placeholder="Search">

            </div>
          </form>
        </div>



        </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->



  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">

<section class="content-header">
      <h1>
        Gruppen
      </h1>
    </section>

    <!-- Main content -->
    <section class="content">
        
       
        
      <div class="row">
        <div class="col-md-12">

          <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#tab_1" data-toggle="tab">Aktuelle Gruppen</a></li>
              <li><a href="#tab_2" data-toggle="tab">Gruppenanfragen <span class="label label-success">2</span></a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="tab_1">
                
             <div class="box box-solid">
          
            <!-- /.box-header -->
            <div class="box-body">
              <div class="box-group" id="accordion">
                <!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
                <div class="panel box box-warning">

                <ul id="groupList"></ul>
                  </div>
                  
                  
                  
                  
          </div>
            </div>
             </div>
             
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="tab_2">
               <div id="eventView">
              <!-- THE CALENDAR -->
              <div class="box box-solid">
          
            <!-- /.box-header -->
            <div class="box-body">
              <div class="box-group" id="accordion">
                <!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
                <div class="panel box box-warning">
                  <div class="box-header with-border">
                    <h4 class="box-title">
                      <a class="groupInviteName" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
Theatergruppe
                        </a>
                    </h4>
                      
                       <button type="button" class="noGroup btn btn-danger btn-sm pull-right"><span class="ion-close-circled"> </span></button>
                          <button type="button" class="yesGroup btn btn-success btn-sm pull-right"><span class="ion-checkmark-circled"></span></button>
                       
                     
                  </div>
                  <div id="collapseOne" class="panel-collapse collapse">
                    <div class="box-body">
                      Mitglieder
                        <br>
                       
                    </div>
                  </div>
                </div>
                <div class="panel box box-danger">
                  <div class="box-header with-border">
                    <h4 class="box-title">
                      <a class="groupInviteName" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
Regensburg-Gruppe                    </a>
                    </h4>
                      <button type="button" class="noGroup btn btn-danger btn-sm pull-right"><span class="ion-close-circled"> </span></button>
                          <button type="button" class="yesGroup btn btn-success btn-sm pull-right"><span class="ion-checkmark-circled"></span></button>
                       
                  </div>
                  <div id="collapseTwo" class="panel-collapse collapse">
                    <div class="box-body">
                     Mitlgieder
                        <br>
                        
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
            </div>
             
                
                
                
                
                </div>
              <!-- /.tab-pane -->
            
              <button id="addNewGroup" type="button" class="btn btn-primary">Neue Gruppe hinzufügen</button>
            </div>
            <!-- /.tab-content -->
          </div>

            </div>
          
          
        <div id="userOverview" class="modal fade modal-primary">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Nutzer in dieser Gruppe:<b> 25</b></h4>
              </div>
              <div class="modal-body">
               <ul>
                  <li>Tobias Zirngibl (Ersteller)</li>
                <li>Noch EinUser</li> 
                <li>Und EinDritter</li> 
                <li>Und EinLetzter</li>
                  </ul>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-right" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
          
          
          
           <div id="addGroupModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">Neue Gruppe</h4>
                    </div>
                    <div class="modal-body">
                            <div class="form-group">
                                <label>Name:</label>
                            <input id="groupTitle" type="text" class="form-control" placeholder="Enter..."></input>
                            </div>
                      
                     
                     
                        <div class="form-group">
                            <label>Benutzer auswählen (Mehrfachauswahl):</label>
                            <select id="userList" multiple class="form-control" disabled>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Anmerkungen</label>
                            <textarea class="form-control" rows="3" placeholder="Enter ..." disabled></textarea>
                        </div>  
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Schließen</button>
                        <button id="saveGroup" type="button" class="btn btn-primary">Speichern</button>
                    </div>
                </div>
            </div>
        </div>
    
        
        
        <div id="acceptGroup" class="modal fade modal-primary">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Gruppe beitreten</h4>
              </div>
              <div class="modal-body">
                  <p>Möchten Sie der Gruppe wirklich beitreten?</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success">Gruppe beitreten</button>
              </div>
            </div>
          </div>
        </div>
        
        <div id="declineGroup" class="modal fade modal-primary">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Gruppeneinladung ablehnen</h4>
              </div>
              <div class="modal-body">
                <p>Möchten Sie die Gruppeneinladung wirklich ablehnen?</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger pull-right">Gruppeneinladung ablehnen</button>
                  
              </div>
            </div>
          </div>
        </div>
        
        
        
         <div id="delGroupMod" class="modal fade modal-primary">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Gruppe löschen</h4>
              </div>
              <div class="modal-body">
                <p>Möchten Sie die Gruppe wirklich löschen? Alle Teilnehmer dieser Gruppe werden dadurch ebensfalls entfernt!</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger pull-right">Gruppe löschen</button>
                  
              </div>
            </div>
          </div>
        </div>
        
        <div id="leaveGroupMod" class="modal fade modal-primary">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Gruppe verlassen</h4>
              </div>
              <div class="modal-body">
                <p>Möchten Sie die Gruppe wirklich verlassen? Die verbleibenen Teilnehmer dieser Gruppe werden dadurch nicht entfernt!</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger pull-right">Gruppe verlassen</button>
                  
              </div>
            </div>
          </div>
        </div>
      
          
          </div>

   

    </section>
{% endblock %}
{% block calFunc %}

      $(function () {

      var csrftoken = $.cookie('csrftoken');

function csrfSafeMethod(method) {
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});


var groups = [];


       $.ajax({

    type: "GET",
    url: "http://localhost:8000/api/group/",
    success: function(data)
      {
      for (var key in data) {
            console.log(data);

      var countMember = data[key].members.length;
      console.log(countMember);
          var group = {
              title: data[key].name,
                count: countMember

          }
          groups.push(group);
       $("#groupList").append('<h4 id="groupList'+key+'">'+group.title+'<br>Mitglieder: '+group.count+'</h4><hr>');

          }
      }
      });
    
    $('.delGroup').tooltip({
    'show': true,
        'placement': 'bottom',
        'title': "Gruppe löschen"
    });
    
     
    $('.delGroup').click(function (e){
            e.preventDefault();
            $('#delGroupMod').modal('show');
    });
    
    $('.leaveGroup').tooltip({
    'show': true,
        'placement': 'bottom',
        'title': "Gruppe verlassen"
    });
    
       $('.leaveGroup').click(function (e){
            e.preventDefault();
            $('#leaveGroupMod').modal('show');
    });
    
    $('.yesGroup').tooltip({
    'show': true,
        'placement': 'bottom',
        'title': "Einladung annehmen"
    });
    
    $('.noGroup').tooltip({
    'show': true,
        'placement': 'bottom',
        'title': "Einladung ablehnen"
    });
    
     function OpenModal() {
        $('#userOverview').modal('show');
    };
    
      $("#addNewGroup").click(function (e){
            e.preventDefault();

        $.ajax({
            type: "GET",
            url: "http://localhost:8000/api/actor/",
            success: function(data)
                {
                    for (var key in data) {
                        if(data[key].first_name ==  "" && data[key].last_name == "") {
                            var actorName = "Kein Name angegeben";
                        }
                        else {
                            var actorName = data[key].first_name + " " + data[key].last_name;
                        }
                    var actorEmail = data[key].email;
                    $('#userList').append('<option>'+actorEmail+' - ' + actorName +'</option>');
                    }
                }
        });

            $('#addGroupModal').modal('show');
    });


        $("#saveGroup").click(function (e){
var title = $("#groupTitle").val();
 var memberList = [
                        {"id": 1, "email": "a@b.com"},
                        {"id": 2, "email": "a@c.com"}
                    ];

      console.log(memberList);
var formData = {name: title};

$.ajax({

    url : "http://localhost:8000/api/group/",
    type: "POST",


    data : formData,
    success: function(data, textStatus, jqXHR)
    {

      // ID FEHLT NOCH!!

             /*   $.ajax({
                        url : "http://localhost:8000/api/appointment/4/addActors/",
                        type: "POST",

                        data : "{members: ['a@b.com']}",
                        success: function(data, textStatus, jqXHR)
                        {
                           console.log(jqXHR);
                console.log(textStatus);
                console.log(data);

                        },
                        error: function (jqXHR, textStatus, errorThrown)
                        {
                    console.log(jqXHR);
                        }
                    });*/



    },
    error: function (jqXHR, textStatus, errorThrown)
    {
console.log(jqXHR);
    }
});
        });







    
    $(".yesGroup").click(function (e){
        
         e.preventDefault();
            $('#acceptGroup').modal('show');
    });
    
    $(".noGroup").click(function (e){
            e.preventDefault();
            $('#declineGroup').modal('show');
    });

      });
    {% endblock %}